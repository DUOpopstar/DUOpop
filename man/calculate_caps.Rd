% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils-evaluate_attribution.R
\name{calculate_caps}
\alias{calculate_caps}
\title{Calculate CAPs}
\usage{
calculate_caps(orig_data, syn_data, keys, target, na_as_value = TRUE)
}
\arguments{
\item{orig_data}{A data frame containing the original data set.}

\item{syn_data}{A data frame containing the synthetic data set.}

\item{keys}{A character vector of column names representing quasi-identifiers (\code{q}).}

\item{target}{A character string specifying the name of the target column (\code{t}).}

\item{na_as_value}{Logical; if \code{TRUE} (default), treat \code{NA} as a separate category/value in both target and key columns.}
}
\value{
A single numeric value representing CAPs.
}
\description{
Computes the information disclosure, consisting of group-level information and attribution, in the synthetic data set
using the quasi-identifiers (\code{q}) and a known target variable (\code{t}),
assuming an attacker has access to the synthetic data set and knows the original
values of the quasi-identifiers.

For each combination \eqn{(q, t)} of values from \code{keys} (\eqn{q}) and \code{target} (\eqn{t}), let:
\deqn{n_{qt}^{orig} = \text{number of rows in original data with } (q,t)}
\deqn{n_{qt}^{syn} = \text{number of rows in synthetic data with } (q,t)}
\deqn{n_q^{syn} = \text{number of rows in synthetic data with } q}

For each combination \eqn{(q,t)} in the original data set:
\deqn{\text{CAPs}_{qt} = \frac{n_{qt}^{syn}}{n_q^{syn}}}

The function then returns the weighted mean across all records (weighted by the original counts \eqn{n_{qt}^{orig}}):
\deqn{\text{CAPs} = \text{weighted mean}(\text{CAPs}_{qt}) \text{ for all } (q,t) \in \text{Original data}}
Equivalently:
\deqn{\text{CAPS} = \sum_{q,t} \text{CAPs}_{qt} \times \frac{n_{qt}^{orig}}{N_{orig}} }
\deqn{\text{or: CAPS} = \sum_{q,t} \frac{n_{qt}^{syn}}{n_q^{syn}} \times \frac{n_{qt}^{orig}}{N_{orig}}}
}
\details{
When \code{na_as_value = TRUE} (default), NA values are treated as a distinct category.
This distinction is important when \code{NA} represents a true category (e.g., "not applicable") rather than a missing value.
When \code{na_as_value = FALSE}, any row containing NA in either the target
or any key column will have a CAPs contribution of zero but is still included in the average.

Empty strings ("") are treated as values.
}
\examples{
\dontshow{if (requireNamespace("synthpop", quietly = TRUE)) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
vars <- c("age", "sex", "marital", "income", "ls", "smoke")
orig_data <- synthpop::SD2011[, vars]
syn_data <- synthpop::syn(orig_data)$syn

CAPs <- calculate_caps(orig_data, syn_data, keys = c("age", "sex"), target = "marital")
\dontshow{\}) # examplesIf}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils-evaluate_attribution.R
\name{calculate_hcaps}
\alias{calculate_hcaps}
\title{Calculate hCAPs}
\usage{
calculate_hcaps(holdout_data, syn_data, keys, target, na_as_value = TRUE)
}
\arguments{
\item{holdout_data}{A data frame containing the out-of-sample (real) data not used during synthesis.}

\item{syn_data}{A data frame containing the synthetic data set.}

\item{keys}{A character vector of column names representing quasi-identifiers (\code{q}).}

\item{target}{A character string specifying the name of the target column (\code{t}).}

\item{na_as_value}{Logical; if \code{TRUE} (default), treat \code{NA} as a separate category/value in both target and key columns.}
}
\value{
A single numeric value representing hCAPs.
}
\description{
hCAPs measures how much group-level information from the holdout data
is preserved in the synthetic data set.

For each combination \eqn{(q, t)} of values from \code{keys} (\eqn{q}) and \code{target} (\eqn{t}), let:
\deqn{n_{qt}^{hold} = \text{number of rows in holdout data with } (q,t)}
\deqn{n_{qt}^{syn} = \text{number of rows in synthetic data with } (q,t)}
\deqn{n_q^{syn} = \text{number of rows in synthetic data with } q}
#'
For each combination \eqn{(q,t)} in the holdout data set:
\deqn{\text{hCAPs}_{qt} = \frac{n_{qt}^{syn}}{n_q^{syn}}}

The function then returns the weighted mean across all records (weighted by the holdout counts \eqn{n_{qt}^{hold}}):
\deqn{\text{hCAPs} = \text{weighted mean}(\text{hCAPs}_{qt}) \text{ for all } (q,t) \in \text{Holdout data}}
Equivalently:
\deqn{\text{hCAPs} = \sum_{q,t} \text{hCAPs}_{qt} \times \frac{n_{qt}^{hold}}{N_{hold}}}
\deqn{\text{or: hCAPs} = \sum_{q,t} \frac{n_{qt}^{syn}}{n_q^{syn}} \times \frac{n_{qt}^{hold}}{N_{hold}}}
}
\details{
When \code{na_as_value = TRUE} (default), NA values are treated as a distinct category.
This distinction is important when \code{NA} represents a true category (e.g., "not applicable") rather than a missing value.
When \code{na_as_value = FALSE}, any row containing NA in either the target
or any key column will have a hCAPs contribution of zero but is still included in the average.

Empty strings ("") are treated as values.
}
\examples{
\dontshow{if (requireNamespace("synthpop", quietly = TRUE)) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
vars <- c("age", "sex", "marital", "income", "ls", "smoke")
orig_data <- synthpop::SD2011[, vars]

set.seed(123)
idx <- sample(seq_len(nrow(orig_data)), size = 0.8*nrow(orig_data))
train_data <- orig_data[idx, ]
holdout_data <- orig_data[-idx, ]
syn_data <- synthpop::syn(train_data)$syn

hCAPs <- calculate_hcaps(holdout_data, syn_data, keys = c("age", "sex"), target = "marital")
\dontshow{\}) # examplesIf}
}

% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/utils-evaluate_attribution.R
\name{calculate_capo}
\alias{calculate_capo}
\title{Calculate CAPo}
\usage{
calculate_capo(orig_data, keys, target, na_as_value = TRUE)
}
\arguments{
\item{orig_data}{A data frame containing the original data set.}

\item{keys}{A character vector of column names representing quasi-identifiers (\code{q}).}

\item{target}{A character string specifying the name of the target column (\code{t}).}

\item{na_as_value}{Logical; if \code{TRUE} (default), treat \code{NA} as a separate category/value in both target and key columns.}
}
\value{
A single numeric value representing CAPo.
}
\description{
Calculates the average probability that an attacker, knowing the quasi-identifiers
(\code{q}), can correctly guess the target variable (\code{t}) in the original data set.

CAPo measures the maximum information disclosure, assuming full access to the original data.
For each combination \eqn{(q, t)} of values from \code{keys} (\eqn{q}) and \code{target} (\eqn{t}), let:
\deqn{n_{qt} = \text{number of rows with combination } (q,t)}
\deqn{n_q = \text{number of rows with key combination } q}

For each combination \eqn{q,t}:
\deqn{\text{CAPo}_{qt} = \frac{n_{qt}}{n_q}}

The function then returns the weighted mean across all records:
\deqn{\text{CAPo} = \text{weighted mean}(\text{CAPo}(q,t)) \text{ for all } (q,t) \in \text{Original data}}.
Equivalently:
\deqn{\text{CAPo} = \sum_{q,t} \text{CAPo}_{qt} \times \frac{n_{qt}}{N}}
\deqn{\text{or: CAPo} = \sum_{q,t} \frac{n_{qt}}{n_q} \times \frac{n_{qt}}{N}}
}
\details{
When \code{na_as_value = TRUE} (default), NA values are treated as a distinct category.
This distinction is important when \code{NA} represents a true category (e.g., "not applicable") rather than a missing value.
When \code{na_as_value = FALSE}, any row containing NA in either the target
or any key column will have a CAPo contribution of zero but is still included in the average.

Empty strings ("") are treated as values.
}
\examples{
\dontshow{if (requireNamespace("synthpop", quietly = TRUE)) (if (getRversion() >= "3.4") withAutoprint else force)(\{ # examplesIf}
vars <- c("age", "sex", "marital", "income", "ls", "smoke")
orig_data <- synthpop::SD2011[, vars]
CAPo <- calculate_capo(orig_data, keys = c("age", "sex"), target = "marital")
\dontshow{\}) # examplesIf}
}
